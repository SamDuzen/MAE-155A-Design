clear all; close all; clc;

%% Input Parameters
Wg = 122917.9;
n_missile = 4;
n_eng = 2;
Ma_cruise = 0.85;
Cdo_c = 0.0468; %parasitic drag at cruise
Cdo_d = 0.0493; %parasitic drag at dash speed
WL = 3640; %wing loading [N/m^2]
    WL_Cruise = WL; %change if needed
    WL_dash = WL; %change if needed
e = 0.7; %efficiency factor
    e_combat = e; %change if needed
T2W = 0.56; %thrust to weight ratio
    T2W_dash = T2W; %change if needed
TSFC = 0.71; %Thrust specific fuel consumption (british units)
    TSFC_cruise = TSFC; %change if needed
    TSFC_dash = TSFC; %change if needed
n_max = 7; %Instantaneous turn rate

%% Data input test

t = readtable("test2.tsv", "FileType","text",'Delimiter', '\t');
    n_missile = t.(2)(1);
    n_eng = t.(2)(2);
    Ma_cruise = t.(2)(3);
    e = t.(2)(4);
    e_combat = t.(2)(5);
    n_max = t.(2)(6);
    WL = t.(2)(7);
    WL_Cruise = t.(2)(8);
    WL_dash = t.(2)(9);
    T2W = t.(2)(10);
    T2W_dash = t.(2)(11);
    TSFC = t.(2)(12);
    TSFC


%% Run Sub Functions

%Run wing sizing code to get wing parameters
[Wing_Table,S,b,C_Root,C_Tip,MAC,Y_MAC,Sw_LE,Sw_QC,TaR,ThR,AR,WTA,WIA,DA,S_VT,S_HT,b_HT,C_Root_HT,C_Tip_HT,AR_HT,TaR_HT,MAC_HT,Y_MAC_HT,MAC_VT,Y_MAC_VT,b_VT,C_Root_VT,C_Tip_VT,AR_VT,TaR_VT] = wing_size(Wg);

%Run L2D function
[L2D_cruise,L2D_dash,L2D_combat,v_cruise,v_dash,a_dash] = L2D(Ma_cruise,Cdo_c,Cdo_d,WL_Cruise,WL_dash,AR,e,e_combat,n_max);

%Run gross weight estimation function
[Wg_calc] = gross_weight(n_missile,n_eng,AR,T2W,WL,TSFC_cruise,TSFC_dash,L2D_cruise,L2D_dash,Ma_cruise,v_cruise,v_dash,a_dash,n_max,T2W_dash);
    Wg = Wg_calc(end); %Save last vector entry as converged gross weight